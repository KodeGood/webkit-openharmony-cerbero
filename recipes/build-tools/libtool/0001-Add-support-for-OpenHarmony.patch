From d2ac3926a657bd34fa9a9a2378f70bc5852864ab Mon Sep 17 00:00:00 2001
From: Jani Hautakangas <jani@kodegood.com>
Date: Sat, 4 Oct 2025 01:10:47 +0300
Subject: [PATCH] Add support for OpenHarmony

---
 m4/libtool.m4 | 20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)

diff --git a/m4/libtool.m4 b/m4/libtool.m4
index a3bc337b..f7ee5cf5 100644
--- a/m4/libtool.m4
+++ b/m4/libtool.m4
@@ -2836,6 +2836,26 @@ linux*android*)
   _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
   ;;
 
+linux*ohos*)
+  version_type=none # OpenHarmony doesn't support versioned libraries.
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='$libname$release$shared_ext'
+  soname_spec='$libname$release$shared_ext'
+  finish_cmds=
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+
+  # This implies no fast_install, which is unacceptable.
+  # Some rework will be needed to allow for fast_install
+  # before this can be enabled.
+  hardcode_into_libs=yes
+
+  dynamic_linker='OpenHarmony linker'
+  # Don't embed -rpath directories since the linker doesn't support them.
+  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
+  ;;
+
 # This must be glibc/ELF.
 linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
   version_type=linux # correct to gnu/linux during the next big refactor
-- 
2.48.1

