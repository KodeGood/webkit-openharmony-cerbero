From dc2d79b32fa6e21731acae90fa44f97c0e3d921e Mon Sep 17 00:00:00 2001
From: Jani Hautakangas <jani@kodegood.com>
Date: Sun, 5 Oct 2025 00:29:47 +0300
Subject: [PATCH] Add OHOS support

---
 meson.build                              | 4 ++++
 webrtc/rtc_base/platform_thread_types.cc | 4 +++-
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/meson.build b/meson.build
index 3843e92..c148bda 100644
--- a/meson.build
+++ b/meson.build
@@ -86,6 +86,10 @@ elif host_system == 'android'
   os_deps += [cc.find_library('log')]
   os_deps += [dependency('gnustl', required : get_option('gnustl'))]
   have_posix = true
+elif host_system == 'ohos'
+  os_cflags += ['-DWEBRTC_OHOS', '-DWEBRTC_LINUX']
+  os_deps += [dependency('gnustl', required : get_option('gnustl'))]
+  have_posix = true
 elif host_system == 'linux'
   os_cflags += ['-DWEBRTC_LINUX', '-DWEBRTC_THREAD_RR']
   os_deps += [cc.find_library('rt', required : false)]
diff --git a/webrtc/rtc_base/platform_thread_types.cc b/webrtc/rtc_base/platform_thread_types.cc
index ea1dd61..9c46700 100644
--- a/webrtc/rtc_base/platform_thread_types.cc
+++ b/webrtc/rtc_base/platform_thread_types.cc
@@ -35,6 +35,8 @@ PlatformThreadId CurrentThreadId() {
   return pthread_mach_thread_np(pthread_self());
 #elif defined(WEBRTC_ANDROID)
   return gettid();
+#elif defined(WEBRTC_OHOS)
+  return gettid();
 #elif defined(WEBRTC_FUCHSIA)
   return zx_thread_self();
 #elif defined(WEBRTC_LINUX)
@@ -107,7 +109,7 @@ void SetCurrentThreadName(const char* name) {
   }
 #endif
 #pragma warning(pop)
-#elif defined(WEBRTC_LINUX) || defined(WEBRTC_ANDROID)
+#elif defined(WEBRTC_LINUX) || defined(WEBRTC_ANDROID) || defined(WEBRTC_OHOS)
   prctl(PR_SET_NAME, reinterpret_cast<unsigned long>(name));  // NOLINT
 #elif defined(WEBRTC_MAC) || defined(WEBRTC_IOS)
   pthread_setname_np(name);
-- 
2.48.1

